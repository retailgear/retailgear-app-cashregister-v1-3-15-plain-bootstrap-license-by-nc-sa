<div class="card shadow-sm">
    <div class="card-header py-3 d-flex justify-content-between align-items-center">
        <h3 class="m-0 fw-bolder">{{ 'ACTIVITY_DETAILS' | translate}}</h3>
        <div>
            <a class="cancel my-auto" (click)="close({action: false, oData: {oCurrentCustomer: oCurrentCustomer}})">
                <i class="fa fa-times fabutton"></i>
            </a>
        </div>
    </div>
    <div class="card-body bg-light-gray">
        <div class="col-xl-12 col-sm-12">
            <div class="row">
                <div class="col-xl-2 col-sm-3">
                    <div class="card"> <!-- style="width: 18rem;" -->
                        <div class="card-header justify-content-center align-items-center text-center m-0 ps-0 pe-0">
                            <h3 class="my-1">{{sNumber}}</h3>
                        </div>

                        <div class="card-body p-3">
                            <div *ngIf="bShowOrderDownload" class="d-flex flex-column mb-3">
                                <div class="d-flex">
                                    <button class="btn btn-primary btn-sm me-2" [disabled]="bDownloadReceipt"
                                        (click)="downloadReceipt($event , 'downloadReceipt')">{{ 'DOWNLOAD' | translate}}</button>
                                    <button class="btn btn-primary btn-sm" [disabled]="bDownloadReceipt"
                                        (click)="downloadReceipt($event , 'downloadReceipt', true)">{{ 'PRINT' | translate}}</button>
                                </div>
                                <div class="spinner-border mx-auto" *ngIf="bActivityPdfGenerationInProgress"></div>
                            </div>

                            <!-- Activity/Activity-Item/Transaction Customer Showing Start -->
                            <div class="d-flex flex-column">
                                <p class="m-0 mb-2"><strong>{{ "CURRENT_CUSTOMER" | translate}}</strong></p>
                                <div class="d-block">
                                    <p class="m-0 text-gray-600 text-truncate">
                                        <span *ngIf="!oCurrentCustomer?.bIsCompany">
                                            {{oCurrentCustomer?.sFirstName}} {{oCurrentCustomer?.sLastName}}
                                        </span>
                                        <span *ngIf="oCurrentCustomer?.bIsCompany">
                                            {{oCurrentCustomer?.sCompanyName || "-"}}
                                        </span>
                                    </p>
                                    <div class="d-flex align-items-center" *ngIf="!customer?.bCounter && oCurrentCustomer?.sEmail">
                                        <p class="fs-xl-6 fs-sm-7 text-gray-600 m-0">
                                            {{oCurrentCustomer?.sEmail}}
                                            <a href="mailto:{{oCurrentCustomer?.sEmail}}" class="ms-2">
                                                <fa-icon [icon]="faEnvelope"></fa-icon>
                                            </a>
                                        </p>
                                    </div>
                                    <div *ngIf="!customer?.bCounter">
                                        <p class="m-0 fs-7 fw-bolder text-muted text-truncate"
                                            *ngIf="oCurrentCustomer?.oPhone?.sMobile">{{'PHONE_MOBILE' | translate}}
                                        </p>
                                        <p  class="m-0 fs-7"
                                            *ngIf="oCurrentCustomer?.oPhone?.sMobile">
                                            <span>
                                                {{oCurrentCustomer?.oPhone?.sPrefixMobile}}
                                                {{oCurrentCustomer?.oPhone?.sMobile}}
                                                <a href="https://wa.me/{{customer?.oPhone?.sPrefixMobile}}{{removeSpaces(customer?.oPhone?.sMobile)}}"
                                                    target="_blank" *ngIf="oCurrentCustomer?.oPhone?.bWhatsApp && oCurrentCustomer?.oPhone?.sPrefixMobile">
                                                    <i class="fab fa-whatsapp ms-1 ml-2" style="color: #1CB39B;"></i>
                                                </a>
                                            </span>
                                        </p>
                                    </div>
                                    <div *ngIf="!customer?.bCounter">
                                        <p  class="m-0 fs-7 fw-bolder text-muted text-truncate" *ngIf="oCurrentCustomer?.oPhone?.sLandLine">
                                            {{'PHONE_LANDLINE' | translate}}
                                        </p>
                                        <p class="m-0 fs-7"
                                            *ngIf="oCurrentCustomer?.oPhone?.sLandLine">
                                            <span>
                                                {{oCurrentCustomer?.oPhone?.sPrefixLandline}}
                                                {{oCurrentCustomer?.oPhone?.sLandLine}}
                                            </span>
                                        </p>
                                    </div>
                                </div>
                                <button class="col-sm-3 col-md-6 btn btn-primary my-3 btn-custom"
                                    (click)="openCurrentCustomer(oCurrentCustomer)">{{'UPDATE_CURRENT_CUSTOMER'|translate}}
                                </button>
                                <!--IF CUSTOMER IS DIFFERENT FROM SYSTEM CUSTOMER-->
                                <div class="alert alert-warning" role="alert"
                                    *ngIf="showSystemCustomer && !customer?.bCounter">
                                    <p class="m-0">{{"DIFFERENT_CUSTOMER_INFORMATION" | translate}}</p>
                                    <div class="d-flex flex-wrap">
                                        <!-- <button class="btn btn-info w-100 my-3 btn-sm" *ngIf="customer?.bCounter==false"
                                            (click)="openCustomer(customer)">
                                            {{'VIEW'|translate}}
                                        </button> -->
                                        <button class="btn btn-light-warning w-100 btn-sm"
                                            *ngIf="customer?.bCounter==false"
                                            (click)="syncCustomerData(oCurrentCustomer,customer)">
                                            {{'SYNC_DATA'|translate}}
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <!-- Activity/Activity-Item/Transaction Customer Showing End -->

                            <div class="d-flex flex-column">
                                <p class="fw-bolder mb-2">{{ 'CREATER_DETAIL' | translate}}</p>
                                <div class="d-flex align-items-center fs-6 ms-1 my-1">
                                    <img alt="Logo" *ngIf="createrDetail?.sFirstName && (!createrDetail?.sAvatar  || createrDetail.sAvatar == '')" 
                                        src="https://prismanote.com/public/prismanote.png" class="createrImage default border border-warning">
                                    <img alt="Logo" *ngIf="(createrDetail?.sAvatar && createrDetail.sAvatar != '')" [src]="createrDetail.sAvatar"
                                        class="createrImage">
                                    <span>{{createrDetail?.sFirstName}} {{createrDetail?.sLastName}}</span>
                                </div>
                            </div>
                        </div>

                    </div>
                    <div class="alert alert-warning mt-2" role="alert" *ngIf="bShowWarning">
                        {{"THIS_IS_A_MIGRATED_ACTIVITY_TRANSACTION" | translate}}
                    </div>
                </div>

                <div class="col-xl-10 col-sm-9">
                    <div class="accordion" id="kt_accordion_1">
                        <div class="accordion-item" *ngFor="let activity of activityItems; let activityindex = index">
                            <div *ngIf="!eKindValue.includes(activity.oType.eKind)">
                                <div class="accordion-header">
                                    <!--(click)="activity.bIsVisible = !activity.bIsVisible" -->
                                    <button class="accordion-button fs-xl-4  fs-sm-6" type="button"
                                        data-bs-parent="#kt_accordion_1" [class.collapsed]="activityItems.length > 1"
                                        [attr.data-bs-target]="'item'+activityindex" data-bs-toggle="collapse">
                                        <div class="col-3 d-flex align-items-center me-sm-3">
                                            <p class="m-0 fs-xl-4 fs-sm-7 fw-bolder text-truncate">{{activity?.sNumber}}</p>
                                            <span class="ms-5" (click)="copyToClipboard(activity)">
                                                <i class="fa fa-copy" title="Click to copy"> </i>
                                                <span @fade *ngIf="activity.bActivityNumberCopied"
                                                    class="text-primary bold ms-2 my-2">
                                                    {{ 'COPIED_TO_CLIPBOARD' | translate }}</span>
                                            </span>
                                        </div>
                                        <div class="col-8 d-flex align-items-center">
                                            <p class="p-0 m-0 me-3 flex-fill">
                                                <span class="fw-bolder text-gray-800">{{'TYPE' | translate}}</span>
                                                <br>
                                                <span class="text-capitalize text-truncate">{{activity?.oType?.eKind || '-'}}</span>
                                            </p>
                                            <p class="p-0 m-0 me-3 flex-fill">
                                                <span class="fw-bolder text-gray-800 text-truncate">{{'INTAKE_DATE' | translate}}</span>
                                                <br>
                                                <span class="text-truncate">{{activity.dCreatedDate | date:'yyyy-MM-dd'}}</span>
                                            </p>
                                            <p class="p-0 m-0 me-3 flex-fill">
                                                <span class="fw-bolder text-gray-800">{{'STATUS' | translate}}</span>
                                                <br>
                                                <span class="text-capitalize d-block text-truncate">
                                                    <div *ngFor="let status of repairStatus">
                                                        <div *ngIf="activity.eActivityItemStatus == status.value">
                                                            {{status.key | translate}}
                                                        </div>
                                                    </div>
                                                </span>
                                            </p>
                                            <p class="p-0 m-0 flex-fill">
                                                <span class="fw-bolder text-gray-800">{{'PRICE' | translate}}</span>
                                                <br>
                                                {{(activity?.nPriceIncVat ? activity?.nPriceIncVat : 0 ) | currency:tillService.currency }}
                                            </p>
                                        </div>
                                    </button>
                                </div>
                                <div class="accordion-collapse collapse general"
                                    *ngIf="eKindValueForLayout.includes(activity.oType.eKind)"
                                    data-bs-parent="#kt_accordion_1" [id]="'item'+activityindex"
                                    [class.show]="activityItems.length == 1">
                                    <div class="accordion-body">
                                        <div class="row">
                                            <div class="col-xl-9 col-sm-8">
                                                <div class="row">
                                                    <div class="col-xl-6 col-sm-6">
                                                        <div class="form-group mb-xl-3 mb-sm-3">
                                                            <label class="form-control-label fw-bolder mb-3">{{ "NAME" |
                                                                translate}}</label>
                                                            <input class="form-control form-control-solid mb-3 mb-lg-0"
                                                                type="text" name="activityName"
                                                                [(ngModel)]="activity.sProductName">
                                                        </div>
                                                        <div class="form-group mb-xl-6 mb-sm-3">
                                                            <label class="form-control-label fw-bolder mb-3">{{ "STATUS" | translate}} </label>
                                                            <select name="status" id="status"
                                                                class="form-control form-control-solid"
                                                                [(ngModel)]="activity.eActivityItemStatus">
                                                                <option *ngFor="let type of repairStatus"
                                                                    [value]="type.value">
                                                                    {{type.key | translate}}
                                                                </option>
                                                            </select>
                                                        </div>
                                                    </div>

                                                    <div class="col-xl-6 col-sm-6 border">
                                                        <div class="row d-flex align-items-center p-3">
                                                            <p class="col-12 p-0 mb-3 fs-xl-6 fs-sm-7">
                                                                {{"INFORM_CUSTOMER_THAT_PRODUCT_CAN_BE_PICKED_UP" |translate}}
                                                            </p>
                                                            <p class="col-xl-2 col-sm-12 fw-bolder fs-xl-7 fs-sm-8 p-0 m-xl-0 mb-xl-0 mb-sm-3 text-truncate">
                                                                {{ "TOTAL_PRICE" | translate}}
                                                            </p>
                                                            <div class="col-xl-7 col-sm-8 ms-xl-3 ms-sm-0 p-0">
                                                                <input class="form-control form-control-solid w-100"
                                                                    type="number"
                                                                    [(ngModel)]="activity.nPriceIncVatAfterDiscount">
                                                            </div>
                                                            <div class="col-xl-2 col-sm-3 ms-xl-3 ms-sm-3 p-0">
                                                                <button
                                                                    [class]="customer?.bCounter?'btn btn-light-primary w-100 disabled p-xl-2 p-sm-1' : 'btn btn-light-primary w-100 p-xl-2 p-sm-1'"
                                                                    (click)="contactCustomer(activity.eEstimatedDateAction)">
                                                                    <fa-icon [icon]="faShare"></fa-icon>
                                                                </button>
                                                            </div>
                                                            <div class="row mt-3 p-0">
                                                                <div class="col-xl-6 col-sm-12">
                                                                    <p class="m-0 fs-xl-6 fs-sm-7">
                                                                        {{"ALREADY_PAID" | translate}}:
                                                                        {{activity.nPaidAmount |
                                                                        currency:tillService.currency}}
                                                                    </p>

                                                                </div>
                                                                <div class="col-xl-6 col-sm-12">
                                                                    <p class="m-0 fs-xl-6 fs-sm-7">
                                                                        {{"STILL_TO_PAY" | translate}}:
                                                                        {{(activity.nPriceIncVatAfterDiscount -
                                                                        activity.nPaidAmount) |
                                                                        currency:tillService.currency}}
                                                                    </p>
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <div class="col-12">
                                                            <div class="row my-3">
                                                                <div class="btn-group" role="group"
                                                                    aria-label="Basic example"
                                                                    title="{{ 'THE_CUSTOMER_WILL_CONTACTED_USING_THIS_METHOD' | translate}}">
                                                                    <button
                                                                        (click)="activity.eEstimatedDateAction='call_on_ready'"
                                                                        [ngClass]="{active:activity.eEstimatedDateAction==='call_on_ready'}"
                                                                        type="button"
                                                                        class="btn btn-light-primary fs-6 p-2">
                                                                        <fa-icon [icon]="faPhone"></fa-icon>
                                                                    </button>
                                                                    <button
                                                                        (click)="activity.eEstimatedDateAction='email_on_ready'"
                                                                        [ngClass]="{active:activity.eEstimatedDateAction==='email_on_ready'}"
                                                                        type="button"
                                                                        class="btn btn-light-primary fs-6 p-2">
                                                                        <fa-icon [icon]="faAt"></fa-icon>
                                                                    </button>
                                                                    <button
                                                                        (click)="activity.eEstimatedDateAction='whatsapp_on_ready'"
                                                                        [ngClass]="{active:activity.eEstimatedDateAction==='whatsapp_on_ready'}"
                                                                        type="button"
                                                                        class="btn btn-light-primary fs-6 p-2">
                                                                        <i class="bi bi-whatsapp"></i>
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="row">
                                                    <div class="col-12">
                                                        <div class="form-group mb-3">
                                                            <label class="form-control-label mb-3 fw-bolder">{{ "DESCRIPTION" |
                                                                translate}}</label>
                                                            <textarea cols="30" rows="3"
                                                                class="form-control form-control-solid" name="description"
                                                                placeholder="{{ 'DESCRIPTION' | translate}}" lines="10"
                                                                [(ngModel)]="activity.sDescription"></textarea>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-xl-3 col-sm-4">
                                                <div class="btn-group me-4 w-100 mb-4">
                                                    <button [disabled]="submitted" [class.btn-pulse]="submitted"
                                                        class="btn btn-lg btn-primary" (click)="submit(activity)"
                                                        type="submit">
                                                        <span *ngIf="submitted" class="mx-3">
                                                            <i class="fa fa-spinner fa-spin"  style="font-size:15px;"></i>
                                                        </span>
                                                        <span class="indicator-label">{{"SAVE_CHANGES" | translate}}</span>
                                                    </button>
                                                </div>
                                                 <div class="btn-group me-4 w-100 mb-4 btnGroupContainer">
                                                    <button class="btn btn-secondary fs-bold"
                                                        (click)="downloadCustomerReceipt(activityindex , 'customerReceipt', 'download')"
                                                        [disabled]="bCustomerReceipt">
                                                        <fa-icon [icon]="faDownload"></fa-icon>
                                                        <span class="indicator-label">{{ "CUSTOMER_RECEIPT" | translate
                                                            }}</span>
                                                    </button>

                                                    <div class="btn btn-secondary btn-icon fs-bold dropdownBtnContainer">
                                                        <span class="btn btn-icon" data-kt-menu-trigger="hover"
                                                            data-kt-menu-attach="parent" data-kt-menu-placement="bottom-end"
                                                            data-kt-menu-flip="bottom">
                                                            <i class="fa fas fa-angle-down"></i>
                                                        </span>
                                                        <div class="menu menu-sub menu-sub-dropdown menu-column menu-rounded menu-gray-600 menu-state-bg-light-primary fw-bolder fs-7 w-200px py-4"
                                                            data-kt-menu="true">
                                                            <div class="menu-item px-3 text-center"
                                                                (click)="downloadCustomerReceipt(activityindex , 'customerReceipt', 'download')">
                                                                <div class="menu-link px-3">
                                                                    <fa-icon [icon]="faDownload"></fa-icon>
                                                                    <span class="ms-5">{{ 'DOWNLOAD' | translate }}</span>
                                                                </div>
                                                            </div>
                                                            <div *ngIf="activity.oType.eKind == 'repair'"
                                                                class="menu-item px-3 text-center"
                                                                (click)="downloadCustomerReceipt(activityindex , 'customerReceipt', 'download', 'alternative')">
                                                                <div class="menu-link px-3">
                                                                    <fa-icon [icon]="faDownload"></fa-icon>
                                                                    <span class="ms-5">{{ 'DOWNLOAD_ALTERNATIVE' | translate
                                                                        }}</span>
                                                                </div>
                                                            </div>
                                                            <div class="menu-item px-3 text-center"
                                                                (click)="downloadCustomerReceipt(activityindex , 'customerReceipt', 'print')">
                                                                <div class="menu-link px-3">
                                                                    <fa-icon [icon]="faPrint"></fa-icon>
                                                                    <span class="ms-5">{{ 'PRINT' | translate }}</span>
                                                                </div>
                                                            </div>
                                                            <div class="menu-item px-3 text-center"
                                                                (click)="downloadCustomerReceipt(activityindex , 'customerReceipt', 'print', 'alternative')">
                                                                <div class="menu-link px-3">
                                                                    <fa-icon [icon]="faPrint"></fa-icon>
                                                                    <span class="ms-5">{{ 'PRINT_ALTERNATIVE' | translate
                                                                        }}</span>
                                                                </div>
                                                            </div>
                                                            <div class="menu-item px-3 text-center"
                                                                (click)="printThermalReceipt(activity)">
                                                                <div class="menu-link px-3">
                                                                    <fa-icon [icon]="faPrint"></fa-icon>
                                                                    <span class="ms-5">{{ 'PRINT_THERMAL' | translate
                                                                        }}</span>
                                                                </div>
                                                            </div>
                                                            <div class="menu-item px-3 text-center"
                                                                (click)="printThermalReceipt(activity, 'repair_alternative')">
                                                                <div class="menu-link px-3">
                                                                    <fa-icon [icon]="faPrint"></fa-icon>
                                                                    <span class="ms-5">{{ 'PRINT_THERMAL_ALTERNATIVE' |
                                                                        translate }}</span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="btn-group me-4 w-100 mb-4">
                                                    <span class="btn btn-secondary fs-bold">
                                                        <fa-icon class="group-icon" [icon]="faReceipt"></fa-icon>
                                                        <span class="indicator-label">{{ "RECEIPT_PARTNER" |
                                                            translate}}</span>
                                                    </span>
                                                    <!-- <span class="btn btn-secondary btn-icon fs-bold" role="button">
                                                        <div class="btn btn-icon" data-kt-menu-trigger="hover"
                                                            data-kt-menu-attach="parent"
                                                            data-kt-menu-placement="bottom-start"
                                                            data-kt-menu-flip="bottom">
                                                            <span class="svg-icon svg-icon-2 m-0">
                                                                <svg xmlns="http://www.w3.org/2000/svg" width="24"
                                                                    height="24" viewBox="0 0 24 24" fill="none">
                                                                    <path
                                                                        d="M11.4343 12.7344L7.25 8.55005C6.83579 8.13583 6.16421 8.13584 5.75 8.55005C5.33579 8.96426 5.33579 9.63583 5.75 10.05L11.2929 15.5929C11.6834 15.9835 12.3166 15.9835 12.7071 15.5929L18.25 10.05C18.6642 9.63584 18.6642 8.96426 18.25 8.55005C17.8358 8.13584 17.1642 8.13584 16.75 8.55005L12.5657 12.7344C12.2533 13.0468 11.7467 13.0468 11.4343 12.7344Z"
                                                                        fill="black"></path>
                                                                </svg>
                                                            </span>
                                                        </div>
                                                        <div class="menu menu-sub menu-sub-dropdown menu-column menu-rounded menu-gray-600 menu-state-bg-light-primary fw-bolder fs-7 w-200px py-4"
                                                            data-kt-menu="true">
                                                            <div class="menu-item px-3 text-center">
                                                                <div class="menu-link px-3">tMenu</div>
                                                            </div>
                                                        </div>
                                                    </span> -->
                                                </div>
                                                <div class="btn-group me-4 w-100 mb-4">
                                                    <span class="btn btn-secondary fs-bold">
                                                        <span>
                                                            <fa-icon class="group-icon" [icon]="faReceipt"></fa-icon>
                                                        </span>
                                                        <span class="indicator-label">{{ "RECEIPT_FOR_BOTH" |
                                                            translate}}</span>
                                                    </span>
                                                    <!-- <span class="btn btn-secondary btn-icon fs-bold" role="button">
                                                        <div class="btn btn-icon" data-kt-menu-trigger="hover"
                                                            data-kt-menu-attach="parent"
                                                            data-kt-menu-placement="bottom-start"
                                                            data-kt-menu-flip="bottom">
                                                            <span class="svg-icon svg-icon-2 m-0">
                                                                <svg xmlns="http://www.w3.org/2000/svg" width="24"
                                                                    height="24" viewBox="0 0 24 24" fill="none">
                                                                    <path
                                                                        d="M11.4343 12.7344L7.25 8.55005C6.83579 8.13583 6.16421 8.13584 5.75 8.55005C5.33579 8.96426 5.33579 9.63583 5.75 10.05L11.2929 15.5929C11.6834 15.9835 12.3166 15.9835 12.7071 15.5929L18.25 10.05C18.6642 9.63584 18.6642 8.96426 18.25 8.55005C17.8358 8.13584 17.1642 8.13584 16.75 8.55005L12.5657 12.7344C12.2533 13.0468 11.7467 13.0468 11.4343 12.7344Z"
                                                                        fill="black"></path>
                                                                </svg>
                                                            </span>
                                                        </div>
                                                        <div class="menu menu-sub menu-sub-dropdown menu-column menu-rounded menu-gray-600 menu-state-bg-light-primary fw-bolder fs-7 w-200px py-4"
                                                            data-kt-menu="true">
                                                            <div class="menu-item px-3 text-center">
                                                                <div class="menu-link px-3">tMenu</div>
                                                            </div>
                                                        </div>
                                                    </span> -->
                                                </div>
                                                <!-- <div class="btn-group me-4 w-100 mb-4" *ngIf="customer?.bCounter==false">
                                                    <span class="btn btn-secondary fs-bold">
                                                        <fa-icon class="group-icon" [icon]="faEnvelope"></fa-icon>
                                                        <span class="indicator-label">{{ "MAIL" | translate}}</span>
                                                    </span>
                                                </div> -->
                                                <!-- [ngClass]="bShowOrderDownload ? 'btn-group me-4 w-100 mb-4': 'btn-group me-4 w-100 mb-4 disabled'" -->
                                                <div class="btn-group me-4 w-100 mb-4">
                                                    <span class="btn btn-secondary fs-bold"
                                                        (click)="loadCashRegister = true; openTransaction(activity, 'activity')">
                                                        <fa-icon class="group-icon" [icon]="faEuro"></fa-icon>
                                                        <span class="indicator-label">{{ "CHECKOUT" | translate}}</span>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div *ngIf="activity.eRepairStatus === 'completed'"
                                            class="col-md-12 card-body d-flex flex-wrap py-5 border mt-5 mb-5 row">
                                            <div class="col-md-8">
                                                <div class="">
                                                    <span>{{ "SHIPPING_METHOD" | translate }} : </span>
                                                    <label class="form-control form-control-solid-solid">{{
                                                        "STANDARD_SHIPPING"
                                                        | translate}}</label>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <label>{{ "CARRIER" | translate}}</label>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <select name="career" id="career"
                                                            class="form-select form-select-solid">
                                                            <option>PostNL</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <input type="text" class="form-control form-control-solid"
                                                        placeholder="www.trackandtracelink.com">
                                                </div>
                                                <div class="row">
                                                    <label>{{ "PLACE_TRACKING_CODE" | translate}}</label>
                                                </div>
                                                <div class="row">
                                                    <label>{{ "OPEN_TRACKING_LINK" | translate}}</label>
                                                </div>
                                            </div>
                                            <div class="col-md-4 gap-5">
                                                <button class="btn btn-primary w-100 d-flex">
                                                    <label class="mx-auto">{{ "SEND_TO_CUSTOMER" | translate}}</label>
                                                </button>
                                                <button class="btn btn-secondary w-100 d-flex">
                                                    <label class="mx-auto"> {{ "READY_TO_PICKUP" | translate}}</label>
                                                </button>
                                                <button class="btn btn-secondary w-100 d-flex">
                                                    <label class="mx-auto">{{ "DELIVER" | translate}}</label>
                                                </button>
                                                <button *ngIf="webOrders" class="btn btn-primary w-100 d-flex"
                                                    (click)="openTransaction(activity, 'activity')">
                                                    <label class="mx-auto"> {{ "OPEN_ACTIVITY" | translate}}</label>
                                                </button>
                                            </div>
                                        </div>

                                        <!-- changed here -->
                                        <div class="row mb-3">
                                            <div class="col-6 mb-3">
                                                <label class="col-12  col-form-label fw-bolder fs-6">{{
                                                    "REMARK_FOR_SERVICE_PARTNERS" | translate}}</label>
                                                <div class="col-12">
                                                    <div class="row">
                                                        <div class="col-lg-12 fv-row">
                                                            <textarea
                                                                class="form-control form-control-lg form-control-solid mb-3 mb-lg-0 w-100"
                                                                placeholder="{{ 'REMARK_FOR_SERVICE_PARTNERS' | translate}}"
                                                                lines="10"
                                                                [(ngModel)]="activity.sCommentVisibleServicePartner"></textarea>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-6 mb-3">
                                                <label class="col-xl-12 col-form-label fw-bolder fs-6">{{"REMARK_FOR_COLLEAGUES"
                                                    | translate}}</label>
                                                <div class="col-xl-12">
                                                    <div class="row">
                                                        <div class="col-lg-12 fv-row">
                                                            <textarea
                                                                class="form-control form-control-lg form-control-solid mb-3 mb-lg-0 w-100"
                                                                placeholder="{{ 'REMARK_FOR_COLLEAGUES' | translate}}"
                                                                lines="10"
                                                                [(ngModel)]="activity.sCommentVisibleColleagues"></textarea>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-xl-4 col-sm-6 order-sm-1">
                                                <div class="row mb-3">
                                                    <label class="col-lg-5 col-form-label fw-bolder fs-6">{{ "INTAKE_DATE" | translate}}</label>
                                                    <div class="col-lg-7 fv-row">
                                                        <input type="date"
                                                            class="form-control form-control form-control-solid"
                                                            name="dCreatedDate"
                                                            [ngModel]="activity.dCreatedDate | date:'yyyy-MM-dd'"
                                                            (ngModelChange)="activity.dCreatedDate = $event"
                                                            readonly />

                                                    </div>
                                                </div>
                                                <div class="row mb-3">
                                                    <label class="col-lg-5 col-form-label fw-bolder fs-6">{{"LOCATION" |
                                                        translate}}</label>
                                                    <div class="col-lg-7 fv-row">
                                                        <input type="text"
                                                            class="form-control form-control-lg form-control-solid mb-3 mb-lg-0 w-100"
                                                            [(ngModel)]="oLocationName" placeholder="" readonly />
                                                    </div>
                                                </div>
                                                <div class="row mb-3">
                                                    <label class="col-lg-5 col-form-label fw-bolder fs-6 text-truncate">{{
                                                        "ESTIMATED_DATE_READY" | translate}}</label>
                                                    <div class="col-lg-7 fv-row">
                                                        <input type="date"
                                                            class="form-control form-control form-control-solid"
                                                            name="dEstimatedDate"
                                                            [ngModel]="activity.dEstimatedDate | date:'yyyy-MM-dd'"
                                                            (ngModelChange)="activity.dEstimatedDate = $event" />
                                                    </div>
                                                </div>

                                                <div class="row mb-3" *ngIf="!activity?.nDiscountToShow">
                                                    <label class="col-lg-5 col-form-label fw-bolder fs-6">{{ 'PRICE_PER_QTY' | translate }}</label>
                                                    <div class="col-lg-7 fv-row">
                                                        <input type="number"
                                                        class="form-control form-control-lg form-control-solid mb-3 mb-lg-0"
                                                        [(ngModel)]="activity.nPriceIncVat"
                                                        (ngModelChange)="updatePriceIncVatWithoutDiscount(activity)">
                                                    </div>
                                                </div>
                                                <div class="row mb-3">
                                                    <label class="col-lg-5 fw-bolder">{{ 'QUANTITY' | translate }}</label>
                                                    <div class="col-lg-7">{{ activity.nQuantity }}</div>
                                                </div>
                                                <ng-container *ngIf="activity?.nDiscountToShow">
                                                    <div class="row mb-3">
                                                        <label class="col-lg-5">{{ 'PRICE_PER_QTY_INC_DISCOUNT' | translate
                                                            }}</label>
                                                        <div class="col-lg-7"><s> {{ activity.nPriceIncVat |
                                                                currency:tillService.currency}}</s></div>
                                                    </div>
                                                    <div class="row mb-3">
                                                        <label class="col-lg-5">{{ 'DISCOUNT_PER_QTY' | translate }}</label>
                                                        <div class="col-lg-7">
                                                            <span *ngIf="activity.bDiscountOnPercentage">
                                                                {{ activity.nDiscount }}%
                                                                ({{ activity.nDiscountToShow | currency:tillService.currency
                                                                }})
                                                            </span>
                                                            <span *ngIf="!activity.bDiscountOnPercentage">
                                                                {{ activity.nDiscountToShow | currency:tillService.currency
                                                                }}
                                                            </span>
                                                        </div>
                                                    </div>
                                                </ng-container>
                                                <div class="row mb-3">
                                                    <label class="col-lg-5 col-form-label fw-bolder fs-6"> {{
                                                        "ESTIMATED_PRICE_UPON_INGESTION" | translate}}</label>
                                                    <div class="col-lg-7 fv-row">
                                                        <input type="number"
                                                            class="form-control form-control-lg form-control-solid mb-3 mb-lg-0 w-100"
                                                            [(ngModel)]="activity.nTotalAmount" placeholder=""
                                                            (ngModelChange)="activity.nPriceIncVatAfterDiscount = $event">
                                                    </div>
                                                </div>
                                                <div class="row mb-3">
                                                    <label class="col-lg-5 col-form-label fw-bolder fs-6">
                                                        {{"TOTAL_PRICE" | translate}}</label>
                                                    <div class="col-lg-7 fv-row">
                                                        <input type="number"
                                                            class="form-control form-control-lg form-control-solid mb-3 mb-lg-0 w-100"
                                                            [(ngModel)]="activity.nPriceIncVatAfterDiscount">
                                                    </div>
                                                </div>

                                            </div>
                                            <div class="col-xl-4 col-sm-12 order-xl-2 order-sm-3 my-sm-3 my-xl-0">
                                                <div class="row mb-3">
                                                    <div class="col-xl-12">
                                                        <button
                                                            *ngIf="activity.oType.eKind == 'repair' || activity.oType.eKind == 'order'"
                                                            class="btn btn-bg-light btn-active-color-primary w-100 mb-3"
                                                            (click)="openImageModal(activityindex)"> 
                                                                <fa-icon class="me-3" [icon]="faUpload"></fa-icon>
                                                                {{ "PHOTO" |translate}}
                                                        </button>
                                                        <div class="d-flex align-items-center mb-3">
                                                            <p class="fw-bolder text-warning m-0" *ngIf="!activity?.aImage?.length || activity?.aImage[0] == ''" >
                                                                {{"NO_IMAGE" | translate}}
                                                            </p>
                                                            <p class="fw-bolder m-0" *ngIf="activity?.aImage?.length && activity?.aImage[0] != ''">
                                                                {{'IMAGES' | translate}}
                                                            </p>
                                                        </div>

                                                        <div [class]="activity.oType.eKind == 'order'? 'd-flex my-3 pb-7' : 'd-flex my-3 flex-wrap'" [style]="activity.oType.eKind == 'order'? 'overflow-y: auto;': 'overflow-y: unset; row-gap: 15px;'" *ngIf="activity?.aImage?.length  && activity?.aImage[0] != ''">
                                                            <div class="image-input p-0 me-5"
                                                                *ngFor="let image of activity.aImage ; let imageIndex = index"
                                                                data-kt-image-input="true"
                                                                style="background-image: url('assets/media/svg/avatars/blank.svg')">
                                                                <div class="image-input-wrapper w-90px h-90px"
                                                                    (click)="openImage(activityindex , imageIndex)"
                                                                    style="background-image: url(assets/media/avatars/300-1.jpg)">
                                                                    <img src={{image}} width="90px" height="90px">
                                                                </div>
                                                                <button
                                                                    class="btn btn-icon btn-circle btn-active-danger w-20px h-20px bg-body"
                                                                    data-kt-image-input-action="remove"
                                                                    data-bs-toggle="tooltip" title="Remove image"
                                                                    (click)="removeImage(activityindex, imageIndex)">
                                                                    <i class="bi bi-x fs-2"></i>
                                                                </button>

                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row mb-3" *ngIf="activity.oType.eKind == 'order'">
                                                    <div class="col-xl-12">
                                                        <p class="mb-2"><strong>{{'PRODUCT_SELECTED' | translate}}</strong></p>
                                                    </div>
                                                    <div class="col-xl-12 mb-3" *ngIf="!activity?.iBusinessProductId">{{'NO_PRODUCT_SELECTED' |translate}}</div>
                                                    <div class="col-xl-12" *ngIf="activity?.iBusinessProductId">
                                                        <p class="mb-3"><span class="text-truncate">{{'PRODUCT_NUMBER' | translate}}</span>: {{activity?.sProductNumber || '-'}}</p>
                                                    </div>
                                                    <div class="col-xl-12" *ngIf="activity?.iBusinessProductId">
                                                        <p class="d-block">
                                                            <span class="text-truncate">{{'ARTICLE_DETAIL' | translate}}</span>: 
                                                            {{activity?.sArticleNumber || '-'}}
                                                            <span *ngIf="activity?.sArticleName">- {{activity?.sArticleName}}</span>
                                                        </p>
                                                    </div>
                                                    <div class="col-xl-12">
                                                        <button class="btn btn-sm btn-warning"
                                                            (click)="assignOrderProduct(activity , activityindex)"> {{'ADD_CHANGE' | translate}}</button>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-xl-4 col-sm-6 order-sm-2">
                                                <div class="row mb-3">
                                                    <label class="col-lg-5 col-form-label fw-bolder fs-6">{{ "REPAIR_NUMBER" |translate}}</label>
                                                    <div class="col-lg-7 fv-row">
                                                        <input type="text"
                                                            class="form-control form-control-lg form-control-solid mb-3 mb-lg-0 w-100"
                                                            [(ngModel)]="activity.sBagNumber" placeholder="">
                                                    </div>
                                                </div>
                                                <div class="row mb-3">
                                                    <label class="col-lg-5 col-form-label fw-bolder fs-6">
                                                        {{"COST_INCURRED(EXCL_VAT)" | translate}}</label>
                                                    <div class="col-lg-7 fv-row">
                                                        <input type="number"
                                                            class="form-control form-control-lg form-control-solid mb-3 mb-lg-0 w-100"
                                                            [(ngModel)]="activity.nActualCost" placeholder="">
                                                    </div>
                                                </div>
                                                <p class="fw-bolder fs-xl-6 my-2">
                                                    {{ "I_REPAIR_THIS_MYSELF" | translate}}
                                                </p>
                                                <div class="row mb-3">
                                                    <label class="col-lg-5 col-form-label fw-bolder fs-6">{{"REPAIRER" | translate}}</label>
                                                    <div class="col-lg-7 fv-row">
                                                        <ng-select *ngIf="!activity.iAssigneeId"
                                                            [(ngModel)]="activity.iAssigneeId"
                                                            (search)="searchEmployees($event.term)"
                                                            class="form-control form-control-solid p-0 w-100 custom"
                                                            placeholder="{{ 'SEARCH_EMPLOYEE' | translate}}"
                                                            [minTermLength]="2" [clearable]="false"
                                                            [isOpen]="filteredEmployees.length > 0"
                                                            (change)="onEmployeeChange($event , activityindex)">
                                                            <ng-option
                                                                *ngFor="let option of filteredEmployees"
                                                                [value]="option">
                                                                {{option.sName ||
                                                                'Unknown'}}</ng-option>
                                                        </ng-select>

                                                        <div class="form-control form-control-solid d-flex justify-content-between align-items-center p-3" 
                                                            *ngIf="activity.iAssigneeId">
                                                            {{activity.employeeName}}
                                                            <div class="d-flex align-items-center justify-content-center"
                                                                (click)="removeEmployeees(activityindex)">
                                                                &nbsp;<i
                                                                    class="close fas fa-times cursor-pointer"></i>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row my-3">
                                                    <div class="col-lg-12 text-center">
                                                        <p class="m-0">{{ "OR" | translate}}</p>
                                                    </div>
                                                </div>
                                                <div class="row mb-3">
                                                    <label class="col-lg-5 col-form-label fw-bolder fs-6">{{"SUPPLIER" | translate}}</label>
                                                    <div class="col-lg-7 fv-row">
                                                        <ng-select *ngIf="!activity.iBusinessPartnerId"
                                                            [(ngModel)]="activity.iBusinessPartnerId"
                                                            (search)="searchSuppliers($event.term)"
                                                            class="form-control form-control-solid p-0 w-100 custom"
                                                            placeholder="{{'SEARCH_REPAIRER' | translate}}"
                                                            [minTermLength]="2" [clearable]="false"
                                                            [isOpen]="supplierOptions.length > 0"
                                                            (change)="onSupplierChange($event,activityindex)">
                                                            <ng-option
                                                                *ngFor="let option of supplierOptions"
                                                                [value]="option">
                                                                {{option.sName ||
                                                                'Unknown'}}</ng-option>
                                                        </ng-select>
                                                        <div class="form-control form-control-solid d-flex justify-content-between align-items-center p-3" 
                                                            *ngIf="activity.iBusinessPartnerId && activity?.sBusinessPartnerName">
                                                            {{activity.sBusinessPartnerName}}
                                                            <div class="d-flex align-items-center justify-content-center"
                                                                (click)="removeSuppliers(activityindex)">
                                                                &nbsp;<i
                                                                    class="close fas fa-times cursor-pointer"></i>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row mb-3">
                                                    <label class="col-lg-5 col-form-label fw-bolder fs-6"><label
                                                            for="brand">{{ "BRAND" | translate}}</label></label>
                                                    <div class="col-lg-7 fv-row">
                                                        <ng-select *ngIf="!activity.iBusinessBrandId"
                                                            [(ngModel)]="activity.iBusinessBrandId"
                                                            (search)="searchBrands($event.term)"
                                                            class="form-control form-control-solid p-0 w-100 custom"
                                                            placeholder="{{'SEARCH_BRAND' | translate }}"
                                                            [minTermLength]="2" [clearable]="false"
                                                            [isOpen]="filteredBrands.length > 0"
                                                            (change)="onBrandChange($event, activityindex)">
                                                            <ng-option
                                                                *ngFor="let option of filteredBrands"
                                                                [value]="option">
                                                                {{option.sName ||
                                                                'Unknown'}}</ng-option>
                                                        </ng-select>
                                                        <div class="form-control form-control-solid d-flex justify-content-between align-items-center p-3" 
                                                            *ngIf="activity.iBusinessBrandId">
                                                            {{activity.brandName}}
                                                            <div class="d-flex align-items-center justify-content-center" (click)="removeBrands(activityindex)">
                                                                &nbsp;<i
                                                                    class="close fas fa-times cursor-pointer"></i>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row align-items-center">
                                                    <label class="col-lg-5 col-form-label fw-bolder fs-6">
                                                        {{ "ARTICLE_GROUP" | translate }}
                                                    </label>
                                                    <div class="col-lg-7 fv-row">
                                                        <ng-select [(ngModel)]="activity.iArticleGroupId" class="form-control form-control-solid p-0" [clearable]="false">
                                                            <ng-option *ngFor="let oArticleGroup of aArticleGroup" [value]="oArticleGroup._id">
                                                                {{oArticleGroup.oName}}
                                                            </ng-option>
                                                        </ng-select>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row table-responsive">
                                            <div class="col-xl-7 col-sm-12">
                                                <table
                                                    class="table align-middle table-row-dashed fs-6 gy-5 dataTable no-footer">
                                                    <thead>
                                                        <tr
                                                            class="text-start text-gray-700 fw-bolder fs-7 text-uppercase gs-0">
                                                            <th>{{ "RECEIPT_NUMBER" | translate}}</th>
                                                            <th>{{ "CREATED_DATE" | translate}}</th>
                                                            <th>{{ "AMOUNT" |translate}}</th>
                                                            <ng-container *ngIf="from != 'transaction-details'">
                                                                <th>{{ 'ACTION' | translate }}</th>
                                                            </ng-container>
                                                        </tr>
                                                    </thead>
                                                    <tbody class="fw-bolder text-gray-600">
                                                        <tr *ngFor='let receipt of activity.receipts'>
                                                            <td>{{receipt.sTransactionNumber}}</td>
                                                            <td>{{receipt.dCreatedDate | date:'MMM dd, yyyy, HH:mm:ss'}}</td>
                                                            <td>{{receipt.nPaymentAmount | currency:
                                                                tillService.currency}}</td>
                                                            <ng-container *ngIf="from != 'transaction-details'">
                                                                <td>
                                                                    <div class="d-flex align-items-center">
                                                                        <button class="btn btn-secondary"
                                                                            (click)="showTransaction(receipt, $event)">
                                                                            {{ 'VIEW' | translate }}
                                                                        </button>
                                                                        <div *ngIf="receipt.bFetchingTransaction"
                                                                            class="spinner-border mx-2"></div>
                                                                    </div>
                                                                </td>
                                                            </ng-container>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>

                                        <!-- <div class="row">
                                            <div class="col-3">
                                                <button [disabled]="submitted" [class.btn-pulse]="submitted"
                                                    class="btn btn-lg btn-primary"
                                                    (click)="submit(activity)" type="submit">
                                                    <span *ngIf="submitted" class="mx-3">
                                                        <i class="fa fa-spinner fa-spin" [hidden]="!submitted"
                                                            style="font-size:15px;"></i>
                                                    </span>
                                                    <span class="indicator-label">{{"SUBMIT" | translate}}</span>
                                                </button>

                                            </div>
                                        </div> -->

                                    </div>
                                </div>
                                <div class="accordion-collapse collapse giftcard" *ngIf="activity.oType.eKind == 'giftcard'"
                                    data-bs-parent="#kt_accordion_1" [id]="'item'+activityindex"
                                    [class.show]="activityItems.length == 1">
                                    <div class="accordion-body">
                                        <div class="row">
                                            <div class="col-xl-9 col-sm-7">
                                                <div class="row">
                                                    <div class="col-xl-6 col-sm-12">
                                                        <div class="form-group mb-3">
                                                            <label class="form-control-label fw-bolder mb-3">{{ "NAME" |
                                                                translate}}</label>
                                                            <input class="form-control form-control-solid mb-3 mb-lg-0"
                                                                type="text" name="activityName"
                                                                [(ngModel)]="activity.sProductName">
                                                        </div>
                                                        <div class="form-group mb-3">
                                                            <label class="form-control-label fw-bolder mb-3">{{ "GIFT_CARD_NUMBER" |
                                                                translate}} </label>
                                                            <input type="text" name="giftCardNumber"
                                                                class="form-control form-control-solid mb-3 mb-lg-0"
                                                                [(ngModel)]="activity.sGiftCardNumber" readonly />
                                                        </div>
                                                    </div>
                                                    <div class="col-xl-6 col-sm-12 border">
                                                        <div class="row d-flex align-items-center p-3">
                                                            <p class="col-xl-12 col-sm-3 fw-bolder fs-xl-7 fs-sm-7 p-0 mb-xl-3 mb-sm-0 text-truncate">{{ "TOTAL_PRICE" | translate}}</p>
                                                            <div class="col-xl-12 col-sm-8 m-0 p-0">
                                                                <input class="form-control form-control-solid w-100"
                                                                    type="number" [(ngModel)]="activity.nPriceIncVat" readonly />
                                                            </div>
                                                            <div class="row mt-3 p-0">
                                                                <div class="col-xl-6 col-sm-6">
                                                                    <p class="p-0 m-0 fs-xl-6 fs-sm-7">
                                                                        {{"ALREADY_PAID" | translate}}: {{activity.nPaidAmount |
                                                                            currency:
                                                                            tillService.currency}}
                                                                    </p>
                                                                    <p class="p-0 m-0 fs-xl-6 fs-sm-7">
                                                                        {{"STILL_TO_PAY" | translate}}: {{(activity.nTotalAmount
                                                                        -
                                                                        activity.nPaidAmount)
                                                                        |
                                                                        currency:
                                                                        tillService.currency}}
                                                                    </p>
                                                                </div>
                                                                <div class="col-xl-6 col-sm-6">
                                                                    <p class="p-0 m-0">
                                                                        <strong>{{'REMAINING_AMOUNT' | translate}}s</strong>:
                                                                        {{activity.nGiftcardRemainingAmount |
                                                                        currency:tillService.currency}}
                                                                    </p> 
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-12">
                                                        <div class="form-group mb-3 mt-xl-0 mt-sm-3">
                                                            <label class="form-control-label fw-bolder mb-3">{{ "DESCRIPTION" |
                                                                translate}}</label>
                                                            <textarea class="form-control form-control-solid" cols="30"
                                                                rows="3" name="description"
                                                                placeholder="{{ 'DESCRIPTION' | translate}}" lines="10"
                                                                [(ngModel)]="activity.sDescription"></textarea>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-xl-3 col-sm-5">
                                                <div class="btn-group me-4 w-100 mb-4">
                                                    <button [disabled]="submitted" [class.btn-pulse]="submitted"
                                                        class="btn btn-lg btn-primary" (click)="submit(activity)"
                                                        type="submit">
                                                        <span *ngIf="submitted" class="mx-3">
                                                            <i class="fa fa-spinner fa-spin"  style="font-size:15px;"></i>
                                                        </span>
                                                        <span class="indicator-label">{{"SAVE_CHANGES" | translate}}</span>
                                                    </button>
                                                </div>
                                                <div class="btn-group me-4 w-100 mb-4">
                                                    <button class="btn btn-secondary fs-bold"
                                                        (click)="downloadCustomerReceipt(activityindex , 'customerReceipt', 'download')"
                                                        [disabled]="bCustomerReceipt">
                                                        <fa-icon class="group-icon" [icon]="faUser"></fa-icon>
                                                        <span class="indicator-label ">{{ "CUSTOMER_RECEIPT" | translate
                                                            }}</span>
                                                    </button>
                                                </div>
                                                <div class="btn-group me-4 w-100 mb-4 btnGroupContainer">
                                                    <button class="btn btn-secondary fs-bold"
                                                        (click)="downloadCustomerReceipt(activityindex , 'downloadCustomerReceipt', 'print')"
                                                        [disabled]="bDownloadCustomerReceipt">
                                                        <fa-icon class="group-icon" [icon]="faPrint"></fa-icon>
                                                        <span class="indicator-label">{{
                                                            "PRINT_VOUCHER" |translate}}</span>
                                                    </button>

                                                    <span class="btn btn-secondary btn-icon fs-bold printer-button-span dropdownBtnContainer"
                                                        role="button">
                                                        <div class="btn btn-icon" data-kt-menu-trigger="hover"
                                                            data-kt-menu-attach="parent"
                                                            data-kt-menu-placement="bottom-start"
                                                            data-kt-menu-flip="bottom">
                                                            <i class="fa fas fa-angle-down"></i>
                                                        </div>
                                                        <div class="menu menu-sub menu-sub-dropdown menu-column menu-rounded menu-gray-600 menu-state-bg-light-primary fw-bolder fs-7 w-200px py-4"
                                                            data-kt-menu="true">
                                                            <div class="menu-item px-3 text-center" (click)="printThermalReceipt(activity, 'giftcard')">
                                                                <div class="menu-link px-3">{{ 'PRINT_THERMAL' | translate}}</div>
                                                            </div>
                                                        </div>
                                                    </span>
                                                </div>

                                                    <!-- STart -->
                                                    <div *ngIf="false" class="btn-group btn_group_container rounded mb-4" role="group"
                                                        aria-label="Button group with nested dropdown">
                                                        <button class="btn btn-secondary fs-bold"
                                                            (click)="downloadCustomerReceipt(activityindex , 'downloadCustomerReceipt', 'print')"
                                                            [disabled]="bDownloadCustomerReceipt">
                                                            <fa-icon class="group-icon" [icon]="faPrint"></fa-icon>
                                                            <span class="indicator-label">{{
                                                                "PRINT_VOUCHER" |translate}}</span>
                                                        </button>
                                                        <div class="btn-group" role="group">
                                                            <button type="button" class="btn px-3 py-2 dropdown_toggle_btn">
                                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                                                                    <path
                                                                        d="M11.4343 12.7344L7.25 8.55005C6.83579 8.13583 6.16421 8.13584 5.75 8.55005C5.33579 8.96426 5.33579 9.63583 5.75 10.05L11.2929 15.5929C11.6834 15.9835 12.3166 15.9835 12.7071 15.5929L18.25 10.05C18.6642 9.63584 18.6642 8.96426 18.25 8.55005C17.8358 8.13584 17.1642 8.13584 16.75 8.55005L12.5657 12.7344C12.2533 13.0468 11.7467 13.0468 11.4343 12.7344Z"
                                                                        fill="black"></path>
                                                                </svg>
                                                            </button>
                                                            <ul class="dropdown_menu">
                                                                <li>
                                                                    <div class="dropdown_item py-2 text-center" (click)="printThermalReceipt(activity, 'giftcard')">
                                                                        <div class="menu-link px-3">{{ 'PRINT_THERMAL' |
                                                                            translate}}</div>
                                                                    </div>
                                                    
                                                                </li>
                                                    
                                                            </ul>
                                                        </div>
                                                    </div>
                                                    <!-- END -->

                                                <div class="btn-group me-4 w-100 mb-4">
                                                    <span class="btn btn-secondary fs-bold"
                                                        (click)="loadCashRegister = true; openTransaction(activity, 'activity')">
                                                        <fa-icon class="group-icon" [icon]="faEuro"></fa-icon>
                                                        <span class="indicator-label">{{ "CHECKOUT" | translate}}</span>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div *ngIf="activity.eRepairStatus === 'completed'"
                                            class="col-md-12 card-body d-flex flex-wrap py-5 border mt-5 mb-5 row">
                                            <div class="col-md-8">
                                                <div class="">
                                                    <span>{{ "SHIPPING_METHOD" | translate }} : </span>
                                                    <label class="form-control form-control-solid-solid">{{
                                                        "STANDARD_SHIPPING"
                                                        | translate}}</label>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <label>{{ "CARRIER" | translate}}</label>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <select name="career" id="career"
                                                            class="form-select form-select-solid">
                                                            <option>PostNL</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <input type="text" class="form-control form-control-solid"
                                                        placeholder="www.trackandtracelink.com">
                                                </div>
                                                <div class="row">
                                                    <label>{{ "PLACE_TRACKING_CODE" | translate}}</label>
                                                </div>
                                                <div class="row">
                                                    <label>{{ "OPEN_TRACKING_LINK" | translate}}</label>
                                                </div>
                                            </div>
                                            <div class="col-md-4 gap-5">
                                                <button class="btn btn-primary w-100 d-flex">
                                                    <label class="mx-auto">{{ "SEND_TO_CUSTOMER" | translate}}</label>
                                                </button>
                                                <button class="btn btn-secondary w-100 d-flex">
                                                    <label class="mx-auto"> {{ "READY_TO_PICKUP" | translate}}</label>
                                                </button>
                                                <button class="btn btn-secondary w-100 d-flex">
                                                    <label class="mx-auto">{{ "DELIVER" | translate}}</label>
                                                </button>
                                                <button *ngIf="webOrders" class="btn btn-primary w-100 d-flex"
                                                    (click)="openTransaction(activity, 'activity')">
                                                    <label class="mx-auto"> {{ "OPEN_ACTIVITY" | translate}}</label>
                                                </button>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-xl-5 col-sm-12 order-xl-1 order-sm-2">
                                                <div class="row mb-3">
                                                    <label class="col-lg-4 col-form-label fw-bolder fs-6">{{ "INTAKE_DATE" |
                                                        translate}}</label>
                                                    <div class="col-lg-8 fv-row">
                                                        <input type="date"
                                                            class="form-control form-control form-control-solid"
                                                            name="dCreatedDate"
                                                            [ngModel]="activity.dCreatedDate | date:'yyyy-MM-dd'"
                                                            (ngModelChange)="activity.dCreatedDate = $event"
                                                            readonly />

                                                    </div>
                                                </div>
                                                <div class="row mb-3">
                                                    <label class="col-lg-4 col-form-label fw-bolder fs-6">{{"LOCATION" |
                                                        translate}}</label>
                                                    <div class="col-lg-8 fv-row">
                                                        <input type="text"
                                                            class="form-control form-control-lg form-control-solid mb-3 mb-lg-0 w-100"
                                                            [(ngModel)]="oLocationName" placeholder="" readonly />
                                                    </div>
                                                </div>
                                                <div class="row mb-3">
                                                    <label class="col-lg-4 col-form-label fw-bolder fs-6"> {{
                                                        "ESTIMATED_PRICE_UPON_INGESTION" | translate}}</label>

                                                    <div class="col-lg-8 fv-row">
                                                        <input type="number"
                                                            class="form-control form-control-lg form-control-solid mb-3 mb-lg-0 w-100"
                                                            [(ngModel)]="activity.nPriceIncVat" placeholder="" readonly>
                                                        <p *ngIf="activity?.oType?.bDiscount">Discount price
                                                            {{activity.nPriceIncVat - activity.nTotalAmount |
                                                            currency:tillService.currency }} </p>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div class="table-responsive col-xl-7 col-sm-12 order-xl-2 order-sm-1 mb-xl-0 mb-sm-3">
                                                <p class="fw-bolder m-0 mb-3 text-uppercase">{{"USAGE_HISTORY"| translate}}</p>
                                                <div class="overflow-scroll py-1 h-200px">
                                                    <table class="table table-hover table-rounded table-striped gy-3 gs-3">
                                                        <thead class="fw-bolder fs-6 text-gray-400 border-gray-200 text-uppercase">
                                                            <tr class="fw-bold fs-6 text-gray-400 text-uppercase border-gray-200">
                                                                <th scope="col" *ngFor="let th of tableUsageHistoryHeaders">
                                                                    {{ th.key | translate }}
                                                                </th>
                                                            </tr>
                                                        </thead>
                                                        <tbody class="align-middle">
                                                            <tr *ngFor="let oItem of activity.aGiftcardRedeemedTransactionData">
                                                                <td>{{ oItem.sNumber }}</td>
                                                                <td>{{ oItem.dRedeemedDate | date:'MMM dd, yyyy, HH:mm:ss' }}</td>
                                                                <td>{{ oItem.nAmount | currency: tillService.currency }}</td>
                                                                <td class="d-flex align-items-center">
                                                                    <button class="btn btn-info btn-sm" (click)="showTransaction(oItem, $event)">
                                                                        <i class="fa fa-eye"></i>
                                                                    </button>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>

                                        </div>
                                        <div class="row table-responsive mt-xl-8 mt-sm-3">
                                            <div class="col-xl-7 col-sm-12">
                                                <table
                                                    class="table table-sm table-hover table-rounded table-striped gs-7">
                                                    <thead class="fw-bolder fs-6 text-gray-400 border-gray-200 text-uppercase">
                                                        <tr>
                                                            <th>{{ "RECEIPT_NUMBER" | translate}}</th>
                                                            <th>{{ "CREATED_DATE" | translate}}</th>
                                                            <th>{{ "AMOUNT" |translate}}</th>
                                                            <ng-container *ngIf="from != 'transaction-details'">
                                                                <th>{{ 'ACTION' | translate }}</th>
                                                            </ng-container>
                                                        </tr>
                                                    </thead>
                                                    <tbody class="align-middle">
                                                        <tr *ngFor='let receipt of activity.receipts'>
                                                            <td>{{receipt.sTransactionNumber}}</td>
                                                            <td>{{receipt.dCreatedDate | date:'MMM dd, yyyy, HH:mm:ss'}}</td>
                                                            <td>{{receipt.nPaymentAmount | currency:
                                                                tillService.currency}}</td>
                                                            <ng-container *ngIf="from != 'transaction-details'">
                                                                <td>
                                                                    <div class="d-flex align-items-center">
                                                                        <button class="btn btn-info btn-sm" (click)="showTransaction(receipt, $event)">
                                                                            <i class="fa fa-eye"></i>
                                                                        </button>
                                                                        <div *ngIf="receipt.bFetchingTransaction"
                                                                            class="spinner-border mx-2"></div>
                                                                    </div>
                                                                </td>
                                                            </ng-container>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                        <!-- <div class="row">
                                            <div class="col-3">
                                                <button [disabled]="submitted" [class.btn-pulse]="submitted"
                                                    class="btn btn-lg btn-primary"
                                                    (click)="submit(activity)" type="submit">
                                                    <span *ngIf="submitted" class="mx-3">
                                                        <i class="fa fa-spinner fa-spin" [hidden]="!submitted"
                                                            style="font-size:15px;"></i>
                                                    </span>

                                                    <span class="indicator-label">{{"SUBMIT" | translate}}</span>

                                                </button>

                                            </div>
                                        </div> -->
                                    </div>
                                </div>
                                <div class="accordion-collapse collapse gold-purchase"
                                    *ngIf="activity.oType.eKind == 'gold-purchase'" data-bs-parent="#kt_accordion_1"
                                    [id]="'item'+activityindex" [class.show]="activityItems.length == 1">
                                    <div class="accordion-body">
                                        <div class="row">
                                            <div class="col-xl-9 col-sm-8">
                                                <div class="row">
                                                    <div class="col-xl-6 col-sm-12">
                                                        <div class="form-group mb-xl-3 mb-sm-3">
                                                            <label class="form-control-label fw-bolder mb-3">{{ "NAME" |
                                                                translate}}</label>
                                                            <input class="form-control form-control-solid mb-3 mb-lg-0"
                                                                type="text" name="activityName"
                                                                [(ngModel)]="activity.sProductName">
                                                        </div>
                                                    </div>

                                                    <div class="col-xl-6 col-sm-12 border">
                                                        <div class="row d-flex align-items-center fw-bolder p-3">
                                                            <p class="col-xl-2 col-sm-12 fw-bolder fs-xl-7 fs-sm-8 p-0 m-xl-0 mb-xl-0 mb-sm-3 text-truncate">{{ "TOTAL_PRICE" | translate}}</p>
                                                            <div class="col-xl-7 col-sm-9 m-0 p-0">
                                                                <input class="form-control form-control-solid w-100"
                                                                    type="text" [(ngModel)]="activity.nPriceIncVat">
                                                            </div>
                                                            <div class="col-xl-2 col-sm-2 ms-xl-0 ms-sm-2 p-0">
                                                                <button class="btn btn-light-primary w-100 disabled">
                                                                    <fa-icon [icon]="faShare"></fa-icon>
                                                                </button>
                                                            </div>
                                                            <div class="row mt-3 p-0">
                                                                <div class="col-6">
                                                                    <p class="m-0 fw-normal">
                                                                        {{"ALREADY_PAID" | translate}}:
                                                                        {{activity.nPaidAmount |
                                                                        currency:tillService.currency}}
                                                                    </p>

                                                                </div>
                                                                <div class="col-6">
                                                                    <p class="m-0 fw-normal">
                                                                        {{"STILL_TO_PAY" | translate}}:
                                                                        {{(activity.nTotalAmount - activity.nPaidAmount) |
                                                                        currency:tillService.currency}}
                                                                    </p>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row mt-xl-0 mt-sm-3">
                                                    <div class="form-group col-12 mb-3">
                                                        <label class="form-control-label fw-bolder mb-3">{{ "DESCRIPTION" |
                                                            translate}}</label>
                                                        <textarea class="form-control form-control-solid" cols="30" rows="8"
                                                            name="description" placeholder="{{ 'DESCRIPTION' | translate}}"
                                                            lines="10" [(ngModel)]="activity.sDescription"></textarea>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-xl-3 col-sm-4">
                                                <div class="btn-group me-4 w-100 mb-4">
                                                    <button [disabled]="submitted" [class.btn-pulse]="submitted"
                                                        class="btn btn-lg btn-primary" (click)="submit(activity)"
                                                        type="submit">
                                                        <span *ngIf="submitted" class="mx-3">
                                                            <i class="fa fa-spinner fa-spin"  style="font-size:15px;"></i>
                                                        </span>
                                                        <span class="indicator-label">{{"SAVE_CHANGES" | translate}}</span>
                                                    </button>
                                                </div>
                                                <div class="btn-group me-4 w-100 mb-4">
                                                    <button class="btn btn-secondary fs-bold"
                                                        (click)="downloadCustomerReceipt(activityindex , 'customerReceipt', 'download')"
                                                        [disabled]="bCustomerReceipt">
                                                        <fa-icon class="group-icon" [icon]="faUser"></fa-icon>
                                                        <span class="indicator-label ">{{ "CUSTOMER_RECEIPT" | translate
                                                            }}</span>
                                                    </button>

                                                    <!-- <span class="btn btn-secondary btn-icon fs-bold" role="button">
                                                        <div class="btn btn-icon" data-kt-menu-trigger="hover"
                                                            data-kt-menu-attach="parent" data-kt-menu-placement="bottom-end"
                                                            data-kt-menu-flip="bottom">
                                                            <span class="svg-icon svg-icon-2 m-0">
                                                                <svg xmlns="http://www.w3.org/2000/svg" width="24"
                                                                    height="24" viewBox="0 0 24 24" fill="none">
                                                                    <path
                                                                        d="M11.4343 12.7344L7.25 8.55005C6.83579 8.13583 6.16421 8.13584 5.75 8.55005C5.33579 8.96426 5.33579 9.63583 5.75 10.05L11.2929 15.5929C11.6834 15.9835 12.3166 15.9835 12.7071 15.5929L18.25 10.05C18.6642 9.63584 18.6642 8.96426 18.25 8.55005C17.8358 8.13584 17.1642 8.13584 16.75 8.55005L12.5657 12.7344C12.2533 13.0468 11.7467 13.0468 11.4343 12.7344Z"
                                                                        fill="black"></path>
                                                                </svg>
                                                            </span>
                                                        </div>
                                                        <div class="menu menu-sub menu-sub-dropdown menu-column menu-rounded menu-gray-600 menu-state-bg-light-primary fw-bolder fs-7 w-200px py-4"
                                                            data-kt-menu="true">
                                                            <div class="menu-item px-3 text-center">
                                                                <div class="menu-link px-3">tMenu</div>
                                                            </div>
                                                            <div class="menu-item px-3 text-center">
                                                                <div class="menu-link px-3">tMenu</div>
                                                            </div>
                                                        </div>
                                                    </span> -->
                                                </div>
                                                <div class="btn-group me-4 w-100 mb-4">
                                                    <button class="btn btn-secondary fs-bold"
                                                        (click)="downloadCustomerReceipt(activityindex , 'downloadCustomerReceipt', 'print')"
                                                        [disabled]="bDownloadCustomerReceipt">
                                                        <fa-icon class="group-icon" [icon]="faPrint"></fa-icon>
                                                        <span class="indicator-label">{{"CUSTOMER_RECEIPT_PRINT" |
                                                            translate}}</span>
                                                    </button>

                                                    <!-- <span class="btn btn-secondary btn-icon fs-bold printer-button-span"
                                                        role="button">
                                                        <div class="btn btn-icon" data-kt-menu-trigger="hover"
                                                            data-kt-menu-attach="parent"
                                                            data-kt-menu-placement="bottom-start"
                                                            data-kt-menu-flip="bottom">
                                                            <span class="svg-icon svg-icon-2 m-0">
                                                                <svg xmlns="http://www.w3.org/2000/svg" width="24"
                                                                    height="24" viewBox="0 0 24 24" fill="none">
                                                                    <path
                                                                        d="M11.4343 12.7344L7.25 8.55005C6.83579 8.13583 6.16421 8.13584 5.75 8.55005C5.33579 8.96426 5.33579 9.63583 5.75 10.05L11.2929 15.5929C11.6834 15.9835 12.3166 15.9835 12.7071 15.5929L18.25 10.05C18.6642 9.63584 18.6642 8.96426 18.25 8.55005C17.8358 8.13584 17.1642 8.13584 16.75 8.55005L12.5657 12.7344C12.2533 13.0468 11.7467 13.0468 11.4343 12.7344Z"
                                                                        fill="black"></path>
                                                                </svg>
                                                            </span>
                                                        </div>
                                                        <div class="menu menu-sub menu-sub-dropdown menu-column menu-rounded menu-gray-600 menu-state-bg-light-primary fw-bolder fs-7 w-200px py-4"
                                                            data-kt-menu="true">
                                                            <div class="menu-item px-3 text-center">
                                                                <div class="menu-link px-3">tMenu</div>
                                                            </div>
                                                        </div>
                                                    </span> -->
                                                </div>
                                                <div class="btn-group me-4 w-100 mb-4">
                                                    <span class="btn btn-secondary fs-bold">
                                                        <fa-icon class="group-icon" [icon]="faReceipt"></fa-icon>
                                                        <span class="indicator-label">{{ "RECEIPT_PARTNER" |
                                                            translate}}</span>
                                                    </span>
                                                    <!-- <span class="btn btn-secondary btn-icon fs-bold" role="button">
                                                        <div class="btn btn-icon" data-kt-menu-trigger="hover"
                                                            data-kt-menu-attach="parent"
                                                            data-kt-menu-placement="bottom-start"
                                                            data-kt-menu-flip="bottom">
                                                            <span class="svg-icon svg-icon-2 m-0">
                                                                <svg xmlns="http://www.w3.org/2000/svg" width="24"
                                                                    height="24" viewBox="0 0 24 24" fill="none">
                                                                    <path
                                                                        d="M11.4343 12.7344L7.25 8.55005C6.83579 8.13583 6.16421 8.13584 5.75 8.55005C5.33579 8.96426 5.33579 9.63583 5.75 10.05L11.2929 15.5929C11.6834 15.9835 12.3166 15.9835 12.7071 15.5929L18.25 10.05C18.6642 9.63584 18.6642 8.96426 18.25 8.55005C17.8358 8.13584 17.1642 8.13584 16.75 8.55005L12.5657 12.7344C12.2533 13.0468 11.7467 13.0468 11.4343 12.7344Z"
                                                                        fill="black"></path>
                                                                </svg>
                                                            </span>
                                                        </div>
                                                        <div class="menu menu-sub menu-sub-dropdown menu-column menu-rounded menu-gray-600 menu-state-bg-light-primary fw-bolder fs-7 w-200px py-4"
                                                            data-kt-menu="true">
                                                            <div class="menu-item px-3 text-center">
                                                                <div class="menu-link px-3">tMenu</div>
                                                            </div>
                                                        </div>
                                                    </span> -->
                                                </div>
                                                <div class="btn-group me-4 w-100 mb-4">
                                                    <span class="btn btn-secondary fs-bold">
                                                        <span>
                                                            <fa-icon class="group-icon" [icon]="faReceipt"></fa-icon>
                                                        </span>
                                                        <span class="indicator-label">{{ "RECEIPT_FOR_BOTH" |
                                                            translate}}</span>
                                                    </span>
                                                    <!-- <span class="btn btn-secondary btn-icon fs-bold" role="button">
                                                        <div class="btn btn-icon" data-kt-menu-trigger="hover"
                                                            data-kt-menu-attach="parent"
                                                            data-kt-menu-placement="bottom-start"
                                                            data-kt-menu-flip="bottom">
                                                            <span class="svg-icon svg-icon-2 m-0">
                                                                <svg xmlns="http://www.w3.org/2000/svg" width="24"
                                                                    height="24" viewBox="0 0 24 24" fill="none">
                                                                    <path
                                                                        d="M11.4343 12.7344L7.25 8.55005C6.83579 8.13583 6.16421 8.13584 5.75 8.55005C5.33579 8.96426 5.33579 9.63583 5.75 10.05L11.2929 15.5929C11.6834 15.9835 12.3166 15.9835 12.7071 15.5929L18.25 10.05C18.6642 9.63584 18.6642 8.96426 18.25 8.55005C17.8358 8.13584 17.1642 8.13584 16.75 8.55005L12.5657 12.7344C12.2533 13.0468 11.7467 13.0468 11.4343 12.7344Z"
                                                                        fill="black"></path>
                                                                </svg>
                                                            </span>
                                                        </div>
                                                        <div class="menu menu-sub menu-sub-dropdown menu-column menu-rounded menu-gray-600 menu-state-bg-light-primary fw-bolder fs-7 w-200px py-4"
                                                            data-kt-menu="true">
                                                            <div class="menu-item px-3 text-center">
                                                                <div class="menu-link px-3">tMenu</div>
                                                            </div>
                                                        </div>
                                                    </span> -->
                                                </div>
                                                <div class="btn-group me-4 w-100 mb-4" *ngIf="customer?.bCounter==false">
                                                    <span class="btn btn-secondary fs-bold">
                                                        <fa-icon class="group-icon" [icon]="faEnvelope"></fa-icon>
                                                        <span class="indicator-label">{{ "MAIL" | translate}}</span>
                                                    </span>
                                                </div>
                                                <div class="btn-group me-4 w-100 mb-4">
                                                    <span class="btn btn-secondary fs-bold"
                                                        (click)="loadCashRegister = true; openTransaction(activity, 'activity')">
                                                        <fa-icon class="group-icon" [icon]="faEuro"></fa-icon>
                                                        <span class="indicator-label">{{ "CHECKOUT" | translate}}</span>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div *ngIf="activity.eRepairStatus === 'completed'"
                                            class="col-md-12 card-body d-flex flex-wrap py-5 border mt-5 mb-5 row">
                                            <div class="col-md-8">
                                                <div class="">
                                                    <span>{{ "SHIPPING_METHOD" | translate }} : </span>
                                                    <label class="form-control form-control-solid-solid">{{
                                                        "STANDARD_SHIPPING"
                                                        | translate}}</label>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <label>{{ "CARRIER" | translate}}</label>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <select name="career" id="career"
                                                            class="form-select form-select-solid">
                                                            <option>PostNL</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <input type="text" class="form-control form-control-solid"
                                                        placeholder="www.trackandtracelink.com">
                                                </div>
                                                <div class="row">
                                                    <label>{{ "PLACE_TRACKING_CODE" | translate}}</label>
                                                </div>
                                                <div class="row">
                                                    <label>{{ "OPEN_TRACKING_LINK" | translate}}</label>
                                                </div>
                                            </div>
                                            <div class="col-md-4 gap-5">
                                                <button class="btn btn-primary w-100 d-flex">
                                                    <label class="mx-auto">{{ "SEND_TO_CUSTOMER" | translate}}</label>
                                                </button>
                                                <button class="btn btn-secondary w-100 d-flex">
                                                    <label class="mx-auto"> {{ "READY_TO_PICKUP" | translate}}</label>
                                                </button>
                                                <button class="btn btn-secondary w-100 d-flex">
                                                    <label class="mx-auto">{{ "DELIVER" | translate}}</label>
                                                </button>
                                                <button *ngIf="webOrders" class="btn btn-primary w-100 d-flex"
                                                    (click)="openTransaction(activity, 'activity')">
                                                    <label class="mx-auto"> {{ "OPEN_ACTIVITY" | translate}}</label>
                                                </button>
                                            </div>
                                        </div>

                                        <div class="row mb-3">
                                            <div class="col-6 mb-3">
                                                <label class="col-12 col-form-label fw-bolder fs-6">{{
                                                    "REMARK_FOR_SERVICE_PARTNERS" | translate}}</label>
                                                <div class="col-12">
                                                    <div class="row">
                                                        <div class="col-lg-12 fv-row">
                                                            <textarea
                                                                class="form-control form-control-lg form-control-solid mb-3 mb-lg-0 w-100"
                                                                placeholder="{{ 'REMARK_FOR_SERVICE_PARTNERS' | translate}}"
                                                                lines="10"
                                                                [(ngModel)]="activity.sCommentVisibleServicePartner"></textarea>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-6 mb-3">
                                                <label class="col-lg-12 col-form-label fw-bolder fs-6">{{
                                                    "REMARK_FOR_COLLEAGUES" |
                                                    translate}}</label>
                                                <div class="col-lg-12">
                                                    <div class="row">
                                                        <div class="col-lg-12 fv-row">
                                                            <textarea
                                                                class="form-control form-control-lg form-control-solid mb-3 mb-lg-0 w-100"
                                                                placeholder="{{ 'REMARK_FOR_SERVICE_PARTNERS' | translate}}"
                                                                lines="10"
                                                                [(ngModel)]="activity.sCommentVisibleCollegues"></textarea>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-xl-6 col-sm-6">
                                                <div class="row mb-3">
                                                    <label class="col-lg-5 col-form-label fw-bolder fs-6">{{ "INTAKE_DATE" |
                                                        translate}}</label>
                                                    <div class="col-lg-7 fv-row">
                                                        <input type="date"
                                                            class="form-control form-control form-control-solid"
                                                            name="dCreatedDate"
                                                            [ngModel]="activity.dCreatedDate | date:'yyyy-MM-dd'"
                                                            (ngModelChange)="activity.dCreatedDate = $event"
                                                            readonly />

                                                    </div>
                                                </div>
                                                <div class="row mb-3">
                                                    <label class="col-lg-5 col-form-label fw-bolder fs-6">{{"LOCATION" |
                                                        translate}}</label>
                                                    <div class="col-lg-7 fv-row">
                                                        <input type="text"
                                                            class="form-control form-control-lg form-control-solid mb-3 mb-lg-0 w-100"
                                                            [(ngModel)]="oLocationName" placeholder="" readonly />
                                                    </div>
                                                </div>

                                                <div class="row mb-3">
                                                    <label class="col-lg-5 col-form-label fw-bolder fs-6"> {{
                                                        "ESTIMATED_PRICE_UPON_INGESTION" | translate}}</label>
                                                    <div class="col-lg-7 fv-row">
                                                        <input type="text"
                                                            class="form-control form-control-lg form-control-solid mb-3 mb-lg-0 w-100"
                                                            [(ngModel)]="activity.nPriceIncVat" placeholder="">
                                                        <p *ngIf="activity?.oType?.bDiscount">Discount price
                                                            {{activity.nPriceIncVat - activity.nTotalAmount |
                                                            currency:tillService.currency }} </p>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-xl-6 col-sm-6">
                                                <div class="row mb-3">
                                                    <label class="col-lg-5 col-form-label fw-bolder fs-6">{{ "REPAIR_NUMBER"
                                                        |translate}}</label>
                                                    <div class="col-lg-7 fv-row">
                                                        <input type="text"
                                                            class="form-control form-control-lg form-control-solid mb-3 mb-lg-0 w-100"
                                                            [(ngModel)]="activity.sBagNumber" placeholder="">
                                                    </div>
                                                </div>
                                                <div class="row mb-3">
                                                    <label class="col-lg-5 col-form-label fw-bolder fs-6">{{
                                                        "COST_INCURRED(EXCL_VAT)" | translate}}</label>
                                                    <div class="col-lg-7 fv-row">
                                                        <input type="text"
                                                            class="form-control form-control-lg form-control-solid mb-3 mb-lg-0 w-100"
                                                            [(ngModel)]="activity.nPriceIncVat" placeholder="">
                                                        <p *ngIf="activity?.oType?.bDiscount">Discount price
                                                            {{activity.nPriceIncVat - activity.nTotalAmount |
                                                            currency:tillService.currency }} </p>
                                                    </div>
                                                </div>
                                                <p class="fw-bolder fs-xl-6 my-2">
                                                    {{ "I_REPAIR_THIS_MYSELF" | translate}}
                                                </p>
                                                
                                                    

                                                    
                                                <div class="row mb-3">
                                                    <label class="col-lg-5 col-form-label fw-bolder fs-6">{{"REPAIRER" | translate}}</label>
                                                    <div class="col-lg-7 fv-row">
                                                        <ng-select *ngIf="!activity.iAssigneeId"
                                                            [(ngModel)]="activity.iAssigneeId"
                                                            (search)="searchEmployees($event.term)"
                                                            class="form-control form-control-solid p-0 w-100 custom"
                                                            placeholder="{{ 'SEARCH_EMPLOYEE' | translate}}"
                                                            [minTermLength]="2" [clearable]="false"
                                                            [isOpen]="filteredEmployees.length > 0"
                                                            (change)="onEmployeeChange($event , activityindex)">
                                                            <ng-option
                                                                *ngFor="let option of filteredEmployees"
                                                                [value]="option">
                                                                {{option.sName ||
                                                                'Unknown'}}</ng-option>
                                                        </ng-select>

                                                        <div class="form-control form-control-solid d-flex justify-content-between align-items-center p-3" 
                                                            *ngIf="activity.iAssigneeId">
                                                            {{activity.employeeName}}
                                                            <div class="d-flex align-items-center justify-content-center"
                                                                (click)="removeEmployeees(activityindex)">
                                                                &nbsp;<i
                                                                    class="close fas fa-times cursor-pointer"></i>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row mb-3">
                                                    <label class="col-lg-5 col-form-label fw-bolder fs-6"><label
                                                            for="brand">{{ "BRAND" | translate}}</label></label>
                                                    <div class="col-lg-7 fv-row">
                                                        <ng-select *ngIf="!activity.iBusinessBrandId"
                                                            [(ngModel)]="activity.iBusinessBrandId"
                                                            (search)="searchBrands($event.term)"
                                                            class="form-control form-control-solid p-0 w-100 custom"
                                                            placeholder="{{'SEARCH_BRAND' | translate }}"
                                                            [minTermLength]="2" [clearable]="false"
                                                            [isOpen]="filteredBrands.length > 0"
                                                            (change)="onBrandChange($event, activityindex)">
                                                            <ng-option
                                                                *ngFor="let option of filteredBrands"
                                                                [value]="option">
                                                                {{option.sName ||
                                                                'Unknown'}}</ng-option>
                                                        </ng-select>
                                                        <div class="form-control form-control-solid d-flex justify-content-between align-items-center p-3" 
                                                            *ngIf="activity.iBusinessBrandId">
                                                            {{activity.brandName}}
                                                            <div class="d-flex align-items-center justify-content-center" (click)="removeBrands(activityindex)">
                                                                &nbsp;<i
                                                                    class="close fas fa-times cursor-pointer"></i>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row table-responsive">
                                            <div class="col-xl-7 col-sm-12">
                                                <table
                                                    class="table align-middle table-row-dashed fs-6 ataTable no-footer">
                                                    <thead>
                                                        <tr
                                                            class="text-start text-gray-700 fw-bolder fs-7 text-uppercase gs-0">
                                                            <th>{{ "RECEIPT_NUMBER" | translate}}</th>
                                                            <th>{{ "CREATED_DATE" | translate}}</th>
                                                            <th>{{ "AMOUNT" |translate}}</th>
                                                            <ng-container *ngIf="from != 'transaction-details'">
                                                                <th>{{ 'ACTION' | translate }}</th>
                                                            </ng-container>
                                                        </tr>
                                                    </thead>
                                                    <tbody class="fw-bolder text-gray-600">
                                                        <tr *ngFor='let receipt of activity.receipts'>
                                                            <td>{{receipt.sTransactionNumber}}</td>
                                                            <td>{{receipt.dCreatedDate | date:'MMM dd, yyyy, HH:mm:ss'}}</td>
                                                            <td>{{receipt.nPaymentAmount | currency:
                                                                tillService.currency}}</td>
                                                            <ng-container *ngIf="from != 'transaction-details'">
                                                                <td>
                                                                    <div class="d-flex align-items-center">
                                                                        <button class="btn btn-info btn-sm"
                                                                            (click)="showTransaction(receipt, $event)">
                                                                            <i class="fa fa-eye"></i>
                                                                        </button>
                                                                        <div *ngIf="receipt.bFetchingTransaction"
                                                                            class="spinner-border mx-2"></div>
                                                                    </div>
                                                                </td>
                                                            </ng-container>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>

                                        <!-- <div class="row">
                                            <div class="col-3">
                                                <button [disabled]="submitted" [class.btn-pulse]="submitted"
                                                    class="btn btn-lg btn-primary"
                                                    (click)="submit(activity)" type="submit">
                                                    <span *ngIf="submitted" class="mx-3">
                                                        <i class="fa fa-spinner fa-spin" [hidden]="!submitted"
                                                            style="font-size:15px;"></i>
                                                    </span>

                                                    <span class="indicator-label">{{"SUBMIT" | translate}}</span>

                                                </button>

                                            </div>
                                        </div> -->

                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="d-flex mt-100">
                            <h5 *ngIf='!activityItems.length && !loading' style="text-align: center">{{'NO_DATA_FOUND' |
                                translate }}
                            </h5>
                            <div *ngIf="loading" class="spinner-border mx-auto"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
